<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>小说阅读器</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: "Microsoft YaHei", sans-serif;
  background: #f5f5f5;
  font-size: 12px;
  color: #333;
}

.reader-container {
  padding: 10px;
  height: 100%;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
}

/* 顶部控件悬浮显示 */
.top-controls {
  display: flex;
  gap: 6px;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s;
  white-space: nowrap;
  overflow-x: auto;
  margin-bottom: 6px;
}
.top-controls::-webkit-scrollbar {
  display: none;
}
.reader-container:hover .top-controls {
  opacity: 1;
}

/* 控件样式缩小 */
input[type="number"], .control-btn {
  font-size: 11px;
  padding: 3px 6px;
  border-radius: 4px;
  border: 1px solid rgba(0,0,0,0.2);
  background: #fff;
  color: #333;
  cursor: pointer;
  width: 45px;  /* 缩短输入框宽度 */
}
input[type="number"]:focus {
  outline: none;
  border-color: #1E90FF;
}
.control-btn:hover {
  border-color: #1E90FF;
  color: #1E90FF;
}

/* 内容区域尽量铺满 */
.content {
  flex: 1;
  font-size: 12px;
  line-height: 1.4;
  white-space: pre-wrap;
  overflow: auto;
  padding: 6px;
  border: 1px solid rgba(0,0,0,0.1);
  background: #fff;
  box-sizing: border-box;
  opacity: 1;
  transition: opacity 0.3s ease; /* 改快翻页动画速度 */
}

/* 状态栏只显示页码 */
.status {
  text-align: center;
  font-size: 11px;
  margin-top: 4px;
}

/* 隐藏文件输入 */
#fileInput { display: none; }

/* 导入按钮 */
#importNovelBtn {
  font-size: 12px;
  padding: 6px 12px;
  margin: 6px 0;
  background: linear-gradient(45deg,#667eea,#764ba2);
  color: #fff;
  border-radius: 4px;
  border: none;
  cursor: pointer;
}
#importNovelBtn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>
</head>
<body>

<div class="reader-container">

  <div class="top-controls">
    <input type="number" id="lineNumberInput" placeholder="页号" min="1" />
    <button class="control-btn" id="goToLineBtn" disabled>跳转</button>
    <button class="control-btn" id="prevBtn" disabled>上一页</button>
    <button class="control-btn" id="nextBtn" disabled>下一页</button>
    <label style="font-size:11px;">自动翻页(秒)</label>
    <input type="number" id="intervalInput" value="5" min="1" max="300" />
    <button class="control-btn" id="startAutoBtn" disabled>开始</button>
    <button class="control-btn" id="stopAutoBtn" disabled>停止</button>
    <label style="font-size:11px;">每页段数</label>
    <input type="number" id="linesPerPageInput" value="3" min="1" max="50" />
  </div>

  <input type="file" id="fileInput" accept=".txt">
  <button id="importNovelBtn">导入小说</button>

  <div class="content" id="contentArea" style="display:none;">
    请导入TXT格式的小说文件开始阅读
  </div>

  <div class="status" id="statusArea">页:0/0</div>

</div>

<script>
class NovelReader {
  constructor() {
    this.content = [];
    this.currentPage = 0;
    this.pages = [];
    this.linesPerPage = 3;
    this.timerId = null;
    this.autoFlipInterval = 5;

    this.initElements();
    this.bindEvents();
  }

  initElements() {
    this.fileInput = document.getElementById('fileInput');
    this.importBtn = document.getElementById('importNovelBtn');
    this.contentArea = document.getElementById('contentArea');
    this.statusArea = document.getElementById('statusArea');
    this.prevBtn = document.getElementById('prevBtn');
    this.nextBtn = document.getElementById('nextBtn');
    this.lineInput = document.getElementById('lineNumberInput');
    this.goBtn = document.getElementById('goToLineBtn');
    this.linesPerPageInput = document.getElementById('linesPerPageInput');
    this.intervalInput = document.getElementById('intervalInput');
    this.startAutoBtn = document.getElementById('startAutoBtn');
    this.stopAutoBtn = document.getElementById('stopAutoBtn');
  }

  bindEvents() {
    this.importBtn.addEventListener('click', ()=>this.fileInput.click());
    this.fileInput.addEventListener('change', e=>{if(e.target.files.length) this.importFile()});
    this.prevBtn.addEventListener('click', ()=>this.prevPage());
    this.nextBtn.addEventListener('click', ()=>this.nextPage());
    this.goBtn.addEventListener('click', ()=>this.goToLine());
    this.linesPerPageInput.addEventListener('change', ()=>{
      this.linesPerPage = parseInt(this.linesPerPageInput.value)||3;
      this.paginate();
      this.currentPage = 0;
      this.updateDisplay();
    });
    this.startAutoBtn.addEventListener('click', ()=>this.startAutoFlip());
    this.stopAutoBtn.addEventListener('click', ()=>this.stopAutoFlip());
  }

  importFile() {
    const file = this.fileInput.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e=>{
      this.content = e.target.result.split(/\r\n|\r|\n/);
      this.currentPage = 0;
      this.paginate();
      this.updateDisplay();
      this.enableControls();
      this.importBtn.style.display='none';
      this.contentArea.style.display='block';
    }
    reader.readAsText(file,'UTF-8');
  }

  paginate() {
    this.pages = [];
    for(let i=0;i<this.content.length;i+=this.linesPerPage){
      this.pages.push(i);
    }
  }

  updateDisplay() {
    if(!this.content.length) return;
    const start = this.pages[this.currentPage];
    const end = (this.currentPage+1<this.pages.length)?this.pages[this.currentPage+1]:this.content.length;

    // 翻页时淡出内容
    this.contentArea.style.opacity = 0;

    setTimeout(() => {
      this.contentArea.textContent = this.content.slice(start,end).join('\n');
      this.statusArea.textContent = `页: ${this.currentPage+1}/${this.pages.length}`;
      this.lineInput.value = this.currentPage+1;
      this.prevBtn.disabled = this.currentPage === 0;
      this.nextBtn.disabled = this.currentPage >= this.pages.length - 1;

      // 翻页时淡入内容
      this.contentArea.style.opacity = 1;
    }, 300); // 更快的过渡速度，调整为 300ms
  }

  prevPage(){ if(this.currentPage>0){this.currentPage--; this.updateDisplay();} }
  nextPage(){ if(this.currentPage<this.pages.length-1){this.currentPage++; this.updateDisplay();} }

  goToLine(){
    let val = parseInt(this.lineInput.value,10);
    if(isNaN(val)||val<1||val>this.pages.length){alert('页号无效'); return;}
    this.currentPage = val-1;
    this.updateDisplay();
  }

  enableControls(){
    this.prevBtn.disabled=false;
    this.nextBtn.disabled=false;
    this.goBtn.disabled=false;
    this.startAutoBtn.disabled=false;
    this.stopAutoBtn.disabled=true;
  }

  startAutoFlip(){
    this.stopAutoFlip();
    let sec = parseInt(this.intervalInput.value,10);
    if(isNaN(sec)||sec<1) sec=5;
    this.autoFlipInterval = sec;
    this.timerId = setInterval(()=>{
      if(this.currentPage<this.pages.length-1){ this.nextPage(); }
      else { this.stopAutoFlip(); }
    }, this.autoFlipInterval*1000);
    this.startAutoBtn.disabled = true;
    this.stopAutoBtn.disabled = false;
    this.intervalInput.disabled = true;
  }

  stopAutoFlip(){
    if(this.timerId){ clearInterval(this.timerId); this.timerId=null; }
    this.startAutoBtn.disabled = false;
    this.stopAutoBtn.disabled = true;
    this.intervalInput.disabled = false;
  }
}

document.addEventListener('DOMContentLoaded', ()=>{ window.novelReader = new NovelReader(); });
</script>

</body>
</html>
